package com.lex.photowall;

import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.support.v4.util.LruCache;

public class ImageLoader {
	/**
	 * 图片缓存技术的核心类，用于缓存所有下载好的图片，在程序内存达到设定值时回将最少最近使用的图片移除掉
	 */
	private static LruCache<String, Bitmap> mMemoryCache;
	
	/*
	 * 类实例
	 */
	private static ImageLoader mImageLoader;
	
	private ImageLoader() {
		//获取程序最大可用内存
		int maxMemory = (int)Runtime.getRuntime().maxMemory();
		//设置图片缓存到校为最大可用内存的1/8
		int cacheSize = maxMemory / 8;
		mMemoryCache = new LruCache<String, Bitmap>(cacheSize) {
			@Override
			protected int sizeOf(String key, Bitmap value) {
				return value.getByteCount();
			}
		};
	}
	
	public ImageLoader getInstance() {
		if(mImageLoader == null) {
			mImageLoader = new ImageLoader();
		}
		return mImageLoader;
	}
	
	public void addBitmapToMemoryCache(String key, Bitmap bitmap) {
		if(getBitmapFromMemoryCache(key) == null) {
			mMemoryCache.put(key, bitmap);
		}
	}
	
	public Bitmap getBitmapFromMemoryCache(String key) {
		return mMemoryCache.get(key);
	}
	
	public static int calculateInSampleSize(BitmapFactory.Options options, int reqWidth) {
		final int width = options.outWidth;
		int inSampleSize = 1;
		if(width > reqWidth) {
			//计算实际宽度与目标宽度的比率
			final int widthRatio = Math.round(width / (float)reqWidth);
			inSampleSize = widthRatio;
		}
		return inSampleSize;
	}

}
